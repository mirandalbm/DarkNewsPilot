Sistema DarkNews Autopilot - Dashboard Completo

Vis√£o Geral do Sistema

Sistema completo de automa√ß√£o de conte√∫do com dashboard integrado para gest√£o de canal de not√≠cias "dark" com m√∫ltiplos idiomas e publica√ß√£o autom√°tica.

Arquitetura do Sistema

Estrutura de Pastas

```
darknews-autopilot/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ dashboard/          # Interface principal
‚îÇ   ‚îú‚îÄ‚îÄ api/               # Endpoints da API
‚îÇ   ‚îú‚îÄ‚îÄ workers/           # Processos em background
‚îÇ   ‚îî‚îÄ‚îÄ utils/             # utilit√°rios
‚îú‚îÄ‚îÄ config/
‚îú‚îÄ‚îÄ storage/
‚îÇ   ‚îú‚îÄ‚îÄ videos/           # V√≠deos processados
‚îÇ   ‚îú‚îÄ‚îÄ temp/            # Arquivos tempor√°rios
‚îÇ   ‚îî‚îÄ‚îÄ database/        # Base de dados
‚îî‚îÄ‚îÄ scripts/             # Scripts de manuten√ß√£o
```

Configura√ß√£o do Ambiente

```python
# config/settings.py
import os
from datetime import timedelta

class Config:
    # API Keys
    ELEVENLABS_API_KEY = os.getenv('ELEVENLABS_API_KEY')
    SYNTHESIA_API_KEY = os.getenv('SYNTHESIA_API_KEY')
    YOUTUBE_API_KEY = os.getenv('YOUTUBE_API_KEY')
    NEWS_API_KEY = os.getenv('NEWS_API_KEY')
    
    # Configura√ß√µes do sistema
    MAX_CONCURRENT_JOBS = 5
    VIDEO_QUALITY = '1080p'
    DEFAULT_LANGUAGES = ['pt-BR', 'es-ES', 'en-US', 'de-DE', 'fr-FR', 'hi-IN', 'ja-JP']
    
    # Templates de avatar
    AVATAR_TEMPLATES = {
        'dark_anchor': 'synthesia_avatar_id_1',
        'mystery_narrator': 'synthesia_avatar_id_2',
        'tech_analyst': 'synthesia_avatar_id_3'
    }
```

Dashboard Principal

```python
# app/dashboard/main.py
import streamlit as st
import pandas as pd
from datetime import datetime, timedelta
from utils.database import Database

class NewsDashboard:
    def __init__(self):
        self.db = Database()
        self.setup_page_config()
        
    def setup_page_config(self):
        st.set_page_config(
            page_title="DarkNews Autopilot",
            page_icon="üåô",
            layout="wide",
            initial_sidebar_state="expanded"
        )
    
    def render_sidebar(self):
        with st.sidebar:
            st.title("üåô DarkNews Control")
            
            # Navega√ß√£o
            nav_option = st.radio("Navega√ß√£o", [
                "üìä Dashboard", 
                "üì∞ Gerenciar Not√≠cias", 
                "üé• Produ√ß√£o de V√≠deos",
                "üåê Multi-Dublagem",
                "üì∫ Publica√ß√£o",
                "üìà Analytics",
                "‚öôÔ∏è Configura√ß√µes"
            ])
            
            # Status do sistema
            st.divider()
            st.subheader("Status do Sistema")
            system_status = self.db.get_system_status()
            st.metric("V√≠deos Hoje", system_status['videos_today'])
            st.metric("Taxa de Sucesso", f"{system_status['success_rate']}%")
            
            # A√ß√µes r√°pidas
            st.divider()
            st.subheader("A√ß√µes R√°pidas")
            if st.button("üîÑ Processar Not√≠cias do Dia"):
                self.trigger_news_processing()
            
            if st.button("‚è∏Ô∏è Pausar Todos os Jobs"):
                self.pause_all_jobs()
    
    def render_main_dashboard(self):
        st.title("üìä Dashboard DarkNews Autopilot")
        
        # M√©tricas principais
        col1, col2, col3, col4 = st.columns(4)
        with col1:
            st.metric("Total de V√≠deos", self.db.get_total_videos())
        with col2:
            st.metric("Canais Ativos", self.db.get_active_channels())
        with col3:
            st.metric("Visualiza√ß√µes Totais", self.db.get_total_views())
        with col4:
            st.metric("Inscritos", self.db.get_total_subscribers())
        
        # Gr√°ficos de performance
        self.render_performance_charts()
        
        # √öltimos v√≠deos processados
        st.subheader("√öltimos V√≠deos Processados")
        self.render_recent_videos()
    
    def render_news_management(self):
        st.title("üì∞ Gerenciamento de Not√≠cias")
        
        # Pesquisa autom√°tica
        if st.button("üîç Pesquisar Not√≠cias do Dia"):
            with st.spinner("Procurando not√≠cias..."):
                news_items = self.fetch_daily_news()
                st.session_state.news_items = news_items
        
        if 'news_items' in st.session_state:
            self.render_news_selection(st.session_state.news_items)
    
    def render_video_production(self):
        st.title("üé• Controle de Produ√ß√£o")
        
        # Configura√ß√µes de produ√ß√£o
        col1, col2 = st.columns(2)
        with col1:
            selected_avatar = st.selectbox(
                "Avatar Principal",
                options=list(Config.AVATAR_TEMPLATES.keys()),
                index=0
            )
        
        with col2:
            video_style = st.selectbox(
                "Estilo do V√≠deo",
                options=['dark_mystery', 'tech_futuristic', 'documentary_style'],
                index=0
            )
        
        # Fila de produ√ß√£o
        st.subheader("Fila de Produ√ß√£o")
        production_queue = self.db.get_production_queue()
        st.dataframe(production_queue, use_container_width=True)
    
    def run(self):
        self.render_sidebar()
        navigation = st.session_state.get('nav_option', 'üìä Dashboard')
        
        if navigation == 'üìä Dashboard':
            self.render_main_dashboard()
        elif navigation == 'üì∞ Gerenciar Not√≠cias':
            self.render_news_management()
        elif navigation == 'üé• Produ√ß√£o de V√≠deos':
            self.render_video_production()
        # ... outros m√©todos de renderiza√ß√£o

if __name__ == "__main__":
    dashboard = NewsDashboard()
    dashboard.run()
```

Sistema de Workers em Background

```python
# app/workers/news_processor.py
import asyncio
import aiohttp
from datetime import datetime
from config.settings import Config

class NewsProcessor:
    def __init__(self):
        self.semaphore = asyncio.Semaphore(Config.MAX_CONCURRENT_JOBS)
    
    async def fetch_news(self):
        """Busca not√≠cias de m√∫ltiplas fontes"""
        async with aiohttp.ClientSession() as session:
            tasks = []
            for source in self.get_news_sources():
                task = self.process_news_source(session, source)
                tasks.append(task)
            
            results = await asyncio.gather(*tasks, return_exceptions=True)
            return self.filter_and_rank_news(results)
    
    async def process_news_source(self, session, source):
        async with self.semaphore:
            try:
                async with session.get(source['url'], 
                                    headers=source['headers'],
                                    timeout=aiohttp.ClientTimeout(total=30)) as response:
                    if response.status == 200:
                        return await self.parse_news_response(await response.json(), source)
            except Exception as e:
                print(f"Error processing {source['name']}: {str(e)}")
                return []
    
    def filter_and_rank_news(self, news_list):
        """Filtra e classifica not√≠cias baseado no engajamento potencial"""
        ranked_news = []
        for news_item in news_list:
            score = self.calculate_viral_score(news_item)
            if score >= 70:  # Apenas not√≠cias com alto potencial
                news_item['viral_score'] = score
                ranked_news.append(news_item)
        
        return sorted(ranked_news, key=lambda x: x['viral_score'], reverse=True)[:10]
```

Sistema de Renderiza√ß√£o de V√≠deo

```python
# app/workers/video_renderer.py
import requests
from tenacity import retry, stop_after_attempt, wait_exponential

class VideoRenderer:
    def __init__(self):
        self.synthesia_api_url = "https://api.synthesia.io/v2/videos"
    
    @retry(stop=stop_after_attempt(3), wait=wait_exponential(multiplier=1, min=4, max=10))
    def render_video(self, script_data, avatar_template, language):
        """Renderiza v√≠deo usando Synthesia API"""
        payload = {
            "title": script_data['title'],
            "description": script_data['description'],
            "visibility": "private",
            "avatar": avatar_template,
            "language": language,
            "script": self.format_script(script_data),
            "background": self.get_background_template(script_data['category']),
            "settings": {
                "quality": Config.VIDEO_QUALITY,
                "subtitles": True,
                "voice": self.get_voice_settings(language)
            }
        }
        
        headers = {
            "Authorization": f"Bearer {Config.SYNTHESIA_API_KEY}",
            "Content-Type": "application/json"
        }
        
        response = requests.post(self.synthesia_api_url, json=payload, headers=headers)
        response.raise_for_status()
        return response.json()['id']
    
    def get_video_status(self, video_id):
        """Verifica status do v√≠deo sendo renderizado"""
        headers = {"Authorization": f"Bearer {Config.SYNTHESIA_API_KEY}"}
        response = requests.get(f"{self.synthesia_api_url}/{video_id}", headers=headers)
        return response.json()['status']
```

Sistema de Gerenciamento de Canais

```python
# app/workers/youtube_manager.py
from googleapiclient.discovery import build
from googleapiclient.http import MediaFileUpload
from google.oauth2 import service_account

class YouTubeManager:
    def __init__(self):
        self.service = self.authenticate_youtube()
    
    def authenticate_youtube(self):
        """Autentica com a API do YouTube"""
        credentials = service_account.Credentials.from_service_account_file(
            'config/youtube-credentials.json',
            scopes=['https://www.googleapis.com/auth/youtube.upload']
        )
        return build('youtube', 'v3', credentials=credentials)
    
    def upload_video(self, video_path, metadata, channel_config):
        """Faz upload de v√≠deo para YouTube"""
        body = {
            'snippet': {
                'title': metadata['title'],
                'description': metadata['description'],
                'tags': metadata['tags'],
                'categoryId': '28'  # News & Politics
            },
            'status': {
                'privacyStatus': 'public',
                'selfDeclaredMadeForKids': False,
                'publishAt': self.get_optimal_publish_time()
            }
        }
        
        media = MediaFileUpload(video_path, chunksize=-1, resumable=True)
        request = self.service.videos().insert(
            part=','.join(body.keys()),
            body=body,
            media_body=media
        )
        
        response = None
        while response is None:
            status, response = request.next_chunk()
            if status:
                print(f"Progresso: {int(status.progress() * 100)}%")
        
        return response['id']
    
    def get_optimal_publish_time(self):
        """Calcula o melhor hor√°rio para publica√ß√£o baseado na audi√™ncia"""
        # Implementar l√≥gica de an√°lise de hor√°rio ideal
        return datetime.now().isoformat() + 'Z'
```

Sistema de Analytics

```python
# app/utils/analytics.py
import pandas as pd
import plotly.express as px
from datetime import datetime, timedelta

class AnalyticsEngine:
    def __init__(self, db):
        self.db = db
    
    def get_performance_report(self, days=7):
        """Gera relat√≥rio de performance"""
        data = self.db.get_analytics_data(days)
        
        report = {
            'total_views': self.calculate_total_views(data),
            'engagement_rate': self.calculate_engagement_rate(data),
            'top_performing_videos': self.get_top_videos(data),
            'language_performance': self.analyze_language_performance(data),
            'optimal_posting_times': self.find_best_posting_times(data)
        }
        
        return report
    
    def generate_visualizations(self, report):
        """Gera visualiza√ß√µes para o dashboard"""
        figs = []
        
        # Gr√°fico de performance por idioma
        lang_df = pd.DataFrame(report['language_performance'])
        fig1 = px.bar(lang_df, x='language', y='views', title='Visualiza√ß√µes por Idioma')
        figs.append(fig1)
        
        # Gr√°fico de hor√°rios ideais
        time_df = pd.DataFrame(report['optimal_posting_times'])
        fig2 = px.line(time_df, x='hour', y='engagement', title='Engajamento por Hora')
        figs.append(fig2)
        
        return figs
```

Script de Inicializa√ß√£o

```python
# main.py
from app.dashboard.main import NewsDashboard
from app.workers.news_processor import NewsProcessor
from app.workers.video_renderer import VideoRenderer
from app.workers.youtube_manager import YouTubeManager
from app.utils.analytics import AnalyticsEngine
import threading
import time

def start_background_workers():
    """Inicia workers em background"""
    news_processor = NewsProcessor()
    video_renderer = VideoRenderer()
    youtube_manager = YouTubeManager()
    
    # Thread para processamento de not√≠cias
    def news_worker():
        while True:
            try:
                news = asyncio.run(news_processor.fetch_news())
                # Salvar not√≠cias no banco e iniciar processamento
                time.sleep(3600)  # Executar a cada hora
            except Exception as e:
                print(f"News worker error: {e}")
                time.sleep(300)
    
    threading.Thread(target=news_worker, daemon=True).start()

if __name__ == "__main__":
    # Iniciar workers em background
    start_background_workers()
    
    # Iniciar dashboard
    dashboard = NewsDashboard()
    dashboard.run()
```

Requirements.txt

```txt
streamlit==1.28.0
pandas==2.0.3
plotly==5.15.0
aiohttp==3.8.5
asyncio==3.4.3
requests==2.31.0
google-api-python-client==2.95.0
google-auth-oauthlib==1.0.0
tenacity==8.2.2
python-dotenv==1.0.0
sqlalchemy==2.0.20
apscheduler==3.10.1
```

Configura√ß√£o do Replit

1. Vari√°veis de Ambiente: Configure no Secrets do Replit:
   ¬∑ ELEVENLABS_API_KEY
   ¬∑ SYNTHESIA_API_KEY
   ¬∑ YOUTUBE_API_KEY
   ¬∑ NEWS_API_KEY
   ¬∑ DATABASE_URL
2. Configura√ß√£o do YouTube:
   ¬∑ Criar Service Account no Google Cloud
   ¬∑ Baixar credentials JSON
   ¬∑ Adicionar ao projeto
3. Execu√ß√£o:

```bash
pip install -r requirements.txt
streamlit run main.py
```

Este sistema fornece um dashboard completo com controle total sobre o fluxo de produ√ß√£o, desde a descoberta de not√≠cias at√© a publica√ß√£o e an√°lise de performance, tudo gerenci√°vel atrav√©s de uma interface web intuitiva.